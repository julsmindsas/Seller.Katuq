<app-breadcrumb [title]="'Tickets'" [items]="['Crear Tickets']" [active_item]="'Crear Tickets'"></app-breadcrumb>
<div class="create-ticket-container">
    <h2 class="title">Crear Nuevo Ticket de Soporte</h2>
    <form [formGroup]="ticketForm" (ngSubmit)="onSubmit()" class="ticket-form">
      <!-- Categoría -->
      <div class="form-group">
        <label for="categoria">Categoría</label>
        <select id="categoria" formControlName="categoria" class="form-control" disabled>
          <option value="funcionalidad katuq" selected>Funcionalidad Katuq</option>
        </select>
      </div>
  
      <!-- Subcategoría -->
      <div class="form-group">
        <label for="subcategoria">Subcategoría</label>
        <select id="subcategoria" formControlName="subcategoria" class="form-control" disabled>
          <option value="general" selected>General</option>
        </select>
      </div>
      
      <!-- Motivo -->
      <div class="form-group">
        <label for="motivo">Motivo</label>
        <select id="motivo" formControlName="motivo" class="form-control">
          <option value="soporte">Soporte</option>
          <option value="idea">Idea</option>
        </select>
      </div>
  
      <!-- Nombre del Usuario que Reporta -->
      <div class="form-group">
        <label for="nombreUsuarioReporta">Nombre del Usuario que Reporta <span class="required-asterisk">*</span></label>
        <input id="nombreUsuarioReporta" formControlName="nombreUsuarioReporta" type="text" class="form-control" required />
        <div *ngIf="ticketForm.get('nombreUsuarioReporta')?.invalid && ticketForm.get('nombreUsuarioReporta')?.touched" class="error">
          El nombre es obligatorio.
        </div>
      </div>
  
      <!-- Fecha del Evento -->
      <div class="form-group">
        <label for="fechaEvento">Fecha del Evento <span class="required-asterisk">*</span></label>
        <input id="fechaEvento" formControlName="fechaEvento" type="date" class="form-control" required />
        <div *ngIf="ticketForm.get('fechaEvento')?.invalid && ticketForm.get('fechaEvento')?.touched" class="error">
          Fecha del evento es obligatoria.
        </div>
      </div>
  
      <!-- Descripción Detallada -->
      <div class="form-group">
        <label for="asunto">Descripción Detallada <span class="required-asterisk">*</span></label>
        <textarea id="asunto" formControlName="asunto" rows="4" class="form-control" required 
                 placeholder="Describa en detalle el problema que experimenta o la idea que quiere compartir..."></textarea>
        <div *ngIf="ticketForm.get('asunto')?.invalid && ticketForm.get('asunto')?.touched" class="error">
          La descripción es obligatoria.
        </div>
      </div>
  
      <!-- Adjuntar Imágenes -->
      <div class="form-group">
        <label for="adjuntos" class="file-upload-label">
          <span class="label-text">Adjuntar Imágenes (Opcional)</span>
          <div class="upload-button">
            <i class="fas fa-upload"></i> Seleccionar Archivos
          </div>
        </label>
        <input type="file" id="adjuntos" (change)="onFileChange($event)" multiple class="custom-file-input" accept="image/*" />
        <small class="form-text text-muted">Puede adjuntar múltiples imágenes para ilustrar mejor su solicitud.</small>
      </div>
  
      <!-- Vista Previa de Imágenes -->
      <div class="image-previews" *ngIf="imagePreviews.length > 0">
        <h5>Vista previa de las imágenes ({{imagePreviews.length}})</h5>
        <div class="preview-container">
          <div class="preview" *ngFor="let preview of imagePreviews">
            <img [src]="preview" alt="Vista previa" class="preview-image" />
            <button type="button" class="remove-image-btn" (click)="removeImage(preview)" title="Eliminar imagen">
              &times;
            </button>
          </div>
        </div>
      </div>
      <br>
  
      <div class="form-help-text">
        <span class="required-note"><span class="required-asterisk">*</span> indica campos obligatorios</span>
      </div>
      <br>
  
      <!-- Botón de Crear Ticket -->
      <button type="submit" class="btn btn-primary btn-block" [disabled]="ticketForm.invalid || isSubmitting">
        <span *ngIf="!isSubmitting">Crear Ticket</span>
        <span *ngIf="isSubmitting">Procesando...</span>
      </button>
    </form>
  </div>
