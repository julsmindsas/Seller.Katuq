<!-- <app-breadcrumb [title]="'Ventas'" [items]="['Ventas/Crear Ventas']" [active_item]="'Crear Ventas'"></app-breadcrumb> -->
<div class="container-fluid">
  <br>
  <div class="row">
    <div class="col-sm-12">
      <div class="card">
        <div class="card-header p-2">
          <div class="row align-items-center">
            <div class="col-md-6">
              <p class="text-left fc-secondary fs-24 m-0 p-0"><i class="icofont icofont-money"></i>&nbsp;Crear Venta</p>
              <p class="text-left text-muted fs-18 m-0 p-0">Preventa # {{pedidoGral.nroPedido}}</p>
              <p *ngIf="pedidoGral?.cliente">Cliente: {{pedidoGral?.cliente.nombres_completos}}
                {{pedidoGral?.cliente.apellidos_completos}}</p>
            </div>
            <div class="col-md-6">
              <div class="warehouse-selector">
                <div class="row align-items-center g-2">
                  <div class="col-auto">
                    <div class="select-header">
                      <i class="fa fa-warehouse me-1"></i>
                      <small class="warehouse-title mb-0">Bodega</small>
                    </div>
                  </div>
                  <div class="col">
                    <select class="form-select form-select-sm" id="bodegaSelect" (change)="onWarehouseChange($event)">
                      <option value="">{{ "Seleccione una bodega" }}</option>
                      <option *ngFor="let bodega of bodegas" [value]="bodega.idBodega">
                        {{ bodega.nombre }} ({{ bodega.idBodega }})
                      </option>
                    </select>
                  </div>
                  <div class="col-auto" *ngIf="selectedWarehouse">
                    <small class="selected-warehouse text-success"><strong>Bodega:</strong> {{ selectedWarehouse }}</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="card-body p-4">
          <aw-wizard #wizard id="wizard" name="wizard" *ngIf="showSteper" navBarLayout="large-filled-symbols" class="simplified-wizard">
            <!-- PASO 1: CATÁLOGO -->
            <aw-wizard-step [navigationSymbol]="{ symbol: '1' }">
              <ng-template awWizardStepSymbol>
                <div class="f1-step">
                  <div class="f1-step-icon"><i class="fa fa-shopping-basket"></i></div>
                  <p class="text-steper">Productos</p>
                </div>
              </ng-template>

              <div class="row mb-3" *ngIf="selectedWarehouse">
                <div class="col-md-4">
                  <div class="input-group">
                    <span class="input-group-text"><i class="fa fa-map-marker-alt"></i></span>
                    <select (change)="onSelectCity($event)" class="form-select">
                      <option value="seleccione">Seleccione ciudad</option>
                      <option *ngFor="let ciudad of empresaActual.ciudadess.ciudadesEntrega" [value]="ciudad.value">
                        {{ ciudad.label }}
                      </option>
                    </select>
                  </div>
                  <div *ngIf="selectedCity" class="text-success mt-1">
                    <small><i class="fa fa-check-circle me-1"></i>Ciudad: {{ selectedCity }}</small>
                  </div>
                </div>
              </div>

              <!-- Catálogo con diseño mejorado -->
              <app-ecomerce-products #products></app-ecomerce-products>

              <!-- Botones de navegación -->
              <div class="wizard-footer-container mt-4">
                <div class="d-flex justify-content-end">
                  <button class="btn btn-success" type="button" awNextStep
                    [disabled]="!(pedidoGral?.carrito && pedidoGral.carrito.length > 0)">
                    <i class="fa fa-shopping-cart me-1"></i> Continuar al Carrito
                  </button>
                </div>
              </div>
            </aw-wizard-step>

            <!-- PASO 2: CARRITO -->
            <aw-wizard-step (stepEnter)="enterStep($event,5)">
              <ng-template awWizardStepSymbol>
                <div class="f1-step">
                  <div class="f1-step-icon"><i class="fa fa-shopping-cart"></i></div>
                  <p class="text-steper">Carrito</p>
                </div>
              </ng-template>
              
              <app-carrito #carrito [pedido]="pedidoGral"></app-carrito>
              
              <div class="mt-3">
                <app-notas #notaspedidos [pedido]="pedidoGral" [carrito]="carrito1"></app-notas>
              </div>

              <!-- Botones de navegación simplificados -->
              <div class="wizard-footer-container mt-4">
                <div class="d-flex justify-content-between">
                  <button class="btn btn-outline-secondary" type="button" awPreviousStep>
                    <i class="fa fa-arrow-left me-1"></i> Volver
                  </button>
                  <button class="btn btn-success" type="button" awNextStep>
                    <i class="fa fa-user me-1"></i> Datos Cliente
                  </button>
                </div>
              </div>
            </aw-wizard-step>

            <!-- PASO 3: DATOS CLIENTE -->
            <aw-wizard-step [navigationSymbol]="{ symbol: '3' }" (stepEnter)="enterStep($event,3)">
              <ng-template awWizardStepSymbol>
                <div class="f1-step">
                  <div class="f1-step-icon">
                    <i class="fa fa-user"></i>
                  </div>
                  <p class="text-steper">Cliente</p>
                </div>
              </ng-template>
              
              <!-- Buscador de clientes mejorado -->
              <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white py-2">
                  <h5 class="mb-0"><i class="fa fa-search me-2"></i>Buscar Cliente</h5>
                </div>
                <div class="card-body py-3">
                  <div class="row g-2">
                    <div class="col-md-3">
                      <select #buscarPor class="form-select" id="tipo_documento">
                        <option value="CC-NIT" selected>Documento</option>
                        <option value="PA">Email</option>
                        <option value="TI">Nombre</option>
                      </select>
                    </div>
                    <div class="col-md-6">
                      <div class="input-group">
                        <span class="input-group-text"><i class="fa fa-user"></i></span>
                        <input #documentoBusqueda class="form-control" type="text" placeholder="Ingrese información de búsqueda" />
                        <button class="btn btn-primary" (click)="buscar()">
                          <i class="fa fa-search"></i> Buscar
                        </button>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <button class="btn btn-success w-100" (click)="crearClienteRapido()">
                        <i class="fa fa-plus-circle me-1"></i> Nuevo Cliente
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Cliente encontrado -->
              <div *ngIf="encontrado" class="card border-success mb-4">
                <div class="card-header bg-success text-white py-2">
                  <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fa fa-check-circle me-2"></i>Cliente Encontrado</h5>
                    <button class="btn btn-light btn-sm" (click)="mostrarFormularioCliente = true">
                      <i class="fa fa-edit me-1"></i> Editar
                    </button>
                  </div>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-6">
                      <div class="mb-2"><strong>Nombre:</strong> {{ pedidoGral.cliente?.nombres_completos }} {{ pedidoGral.cliente?.apellidos_completos }}</div>
                      <div class="mb-2"><strong>Documento:</strong> {{ pedidoGral.cliente?.tipo_documento_comprador }} {{ pedidoGral.cliente?.documento }}</div>
                      <div><strong>Email:</strong> {{ pedidoGral.cliente?.correo_electronico_comprador }}</div>
                    </div>
                    <div class="col-md-6">
                      <div class="mb-2"><strong>Teléfono:</strong> {{ pedidoGral.cliente?.indicativo_celular_comprador }} {{ pedidoGral.cliente?.numero_celular_comprador }}</div>
                      <div><strong>WhatsApp:</strong> {{ pedidoGral.cliente?.indicativo_celular_whatsapp }} {{ pedidoGral.cliente?.numero_celular_whatsapp }}</div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Formulario para crear/editar cliente si es necesario -->
              <div *ngIf="mostrarFormularioCliente" class="card mb-4">
                <div class="card-header py-2">
                  <h5 class="mb-0">{{ encontrado ? 'Editar Cliente' : 'Crear Nuevo Cliente' }}</h5>
                </div>
                <div class="card-body">
                  <form [formGroup]="formulario">
                    <!-- Información personal -->
                    <div class="row mb-3">
                      <div class="col-12">
                        <h6 class="border-bottom pb-2 mb-3">Información Personal</h6>
                      </div>
                      <div class="col-md-4">
                        <label class="form-label" for="tipo_documento">
                          Tipo de Documento <span class="text-danger">*</span>
                        </label>
                        <select class="form-select" id="tipo_documento" formControlName="tipo_documento_comprador">
                          <option value="CC-NIT">CC-NIT</option>
                          <option value="PA">PA</option>
                          <option value="TI">TI</option>
                        </select>
                      </div>
                      <div class="col-md-8">
                        <label class="form-label" for="numero_documento">
                          Documento <span class="text-danger">*</span>
                        </label>
                        <input class="form-control" type="text" id="numero_documento" formControlName="documento" />
                      </div>
                    </div>

                    <div class="row mb-3">
                      <div class="col-md-6">
                        <label class="form-label" for="nombres_completos">
                          Nombres <span class="text-danger">*</span>
                        </label>
                        <input class="form-control" type="text" id="nombres_completos" formControlName="nombres_completos" />
                      </div>
                      <div class="col-md-6">
                        <label class="form-label" for="apellidos_completos">
                          Apellidos <span class="text-danger">*</span>
                        </label>
                        <input class="form-control" type="text" id="apellidos_completos" formControlName="apellidos_completos" />
                      </div>
                    </div>

                    <!-- Información de contacto -->
                    <div class="row mb-3">
                      <div class="col-12">
                        <h6 class="border-bottom pb-2 mb-3">Información de Contacto</h6>
                      </div>
                      
                      <!-- Teléfono Celular -->
                      <div class="col-md-6 mb-3">
                        <label class="form-label fw-medium">Teléfono Celular <span class="text-danger">*</span></label>
                        <div class="input-group">
                          <span class="input-group-text bg-light" style="min-width: 90px;">
                            <select autocomplete="on" formControlName="indicativo_celular_comprador"
                              class="form-select form-select-sm border-0 bg-transparent">
                              <option disabled>Código</option>
                              <option value="57" selected>+57</option>
                              <option value="{{ item.phone_code }}" *ngFor="let item of indicativos">
                                +{{ item.phone_code }}
                              </option>
                            </select>
                          </span>
                          <input class="form-control" type="text" formControlName="numero_celular_comprador"
                            placeholder="Número de celular" />
                        </div>
                      </div>

                      <!-- Correo Electrónico -->
                      <div class="col-md-6 mb-3">
                        <label class="form-label fw-medium" for="correo_electronico">
                          Correo Electrónico <span class="text-danger">*</span>
                        </label>
                        <div class="input-group">
                          <span class="input-group-text bg-light">
                            <i class="fa fa-envelope"></i>
                          </span>
                          <input class="form-control" type="email" id="correo_electronico"
                            placeholder="ejemplo@correo.com" formControlName="correo_electronico_comprador" />
                        </div>
                      </div>

                      <!-- WhatsApp -->
                      <div class="col-12 mb-3">
                        <div class="d-flex align-items-center mb-2">
                          <label class="form-label fw-medium me-3 mb-0">WhatsApp</label>
                          <div class="form-check">
                            <input #whatsapp type="checkbox" class="form-check-input" id="sameAsPhone"
                              (change)="replicarWhatsApp($event)">
                            <label class="form-check-label" for="sameAsPhone">
                              <small>Usar el mismo número de celular</small>
                            </label>
                          </div>
                        </div>
                        <div class="input-group">
                          <span class="input-group-text bg-light" style="min-width: 90px;">
                            <select autocomplete="on" formControlName="indicativo_celular_whatsapp"
                              class="form-select form-select-sm border-0 bg-transparent">
                              <option disabled>Código</option>
                              <option value="57" selected>+57</option>
                              <option value="{{ item.phone_code }}" *ngFor="let item of indicativos">
                                +{{ item.phone_code }}
                              </option>
                            </select>
                          </span>
                          <input class="form-control" type="text" formControlName="numero_celular_whatsapp"
                            placeholder="Número de WhatsApp" />
                          <span class="input-group-text bg-success text-white">
                            <i class="fa fa-whatsapp"></i>
                          </span>
                        </div>
                      </div>
                    </div>

                    <!-- Botones de acción -->
                    <div class="d-flex justify-content-end">
                      <button type="button" class="btn btn-light me-2" (click)="mostrarFormularioCliente = false">
                        <i class="fa fa-times me-1"></i> Cancelar
                      </button>
                      <button *ngIf="!encontrado" type="button" class="btn btn-success" (click)="crearClienteRapido()" 
                        [disabled]="formulario.invalid">
                        <i class="fa fa-save me-1"></i> Guardar Cliente
                      </button>
                      <button *ngIf="encontrado" type="button" class="btn btn-primary" (click)="editarCliente()"
                        [disabled]="formulario.invalid">
                        <i class="fa fa-save me-1"></i> Actualizar
                      </button>
                    </div>
                  </form>
                </div>
              </div>

              <!-- Botones de navegación -->
              <div class="wizard-footer-container">
                <div class="d-flex justify-content-between">
                  <button class="btn btn-outline-secondary" type="button" awPreviousStep>
                    <i class="fa fa-arrow-left me-1"></i> Volver
                  </button>
                  <button class="btn btn-success" type="button" awNextStep [disabled]="!encontrado" 
                    (click)="reviewStepAndExecute(3)">
                    <i class="fa fa-truck me-1"></i> Datos Envío
                  </button>
                </div>
                <div *ngIf="!encontrado" class="alert alert-warning mt-3 small">
                  <i class="fa fa-exclamation-triangle me-2"></i>
                  Debe seleccionar o crear un cliente para continuar
                </div>
              </div>
            </aw-wizard-step>

            <!-- PASO 4: DIRECCIONES DE ENVÍO -->
            <aw-wizard-step [navigationSymbol]="{ symbol: '4' }" (stepEnter)="enterStep($event,4)">
              <ng-template awWizardStepSymbol>
                <div class="f1-step">
                  <div class="f1-step-icon"><i class="fa fa-truck"></i></div>
                  <p class="text-steper">Envío</p>
                </div>
              </ng-template>
              
              <pedido-entrega #entrega 
                [pedidoGral]="pedidoGral" 
                [formulario]="formulario"
                [datosEntregas]="datosEntregas" 
                [documentoBusqueda]="documentoBuscar"
                [direccionEntrega]="direccion_facturacion" 
                [paisInicial]="pais"
                [departamentoInicial]="departamento" 
                [ciudad]="ciudad_municipio"
                [codigoPostal]="codigo_postal"
                [datosEntregaNoEncontradosParaCiudadSeleccionada]="datosEntregaNoEncontradosParaCiudadSeleccionada"
                (overridePedido)="overridePedido($event)" 
                [activeIndex]="0">
              </pedido-entrega>

              <!-- Botones de navegación -->
              <div class="wizard-footer-container mt-4">
                <div class="d-flex justify-content-between">
                  <button class="btn btn-outline-secondary" type="button" awPreviousStep>
                    <i class="fa fa-arrow-left me-1"></i> Volver
                  </button>
                  <button class="btn btn-success" type="button" awNextStep (click)="reviewStepAndExecute(4)"
                    [disabled]="!pedidoGral?.envio">
                    <i class="fa fa-file-invoice me-1"></i> Facturación
                  </button>
                </div>
                <div *ngIf="!pedidoGral?.envio" class="alert alert-warning mt-3 small">
                  <i class="fa fa-exclamation-triangle me-2"></i>
                  Debe seleccionar los datos de envío para continuar
                </div>
              </div>
            </aw-wizard-step>

            <!-- PASO 5: FACTURACIÓN -->
            <aw-wizard-step [navigationSymbol]="{ symbol: '5' }" (stepEnter)="enterStep($event,5)">
              <ng-template awWizardStepSymbol>
                <div class="f1-step">
                  <div class="f1-step-icon"><i class="fa fa-file-invoice"></i></div>
                  <p class="text-steper">Facturación</p>
                </div>
              </ng-template>
              
              <app-pedido-facturacion #facturacion 
                [pedidoGral]="pedidoGral" 
                [formulario]="formulario"
                [datosFacturacionElectronica]="datosFacturacionElectronica" 
                [direccionFacturacion]="direccion_facturacion"
                [paisInicial]="pais" 
                [departamentoInicial]="departamento" 
                [ciudad]="ciudad_municipio"
                [codigoPostal]="codigo_postal" 
                (overridePedido)="overridePedido($event)"
                [generarFactura]="generarFacturaElectronica" 
                [documentoBusqueda]="documentoBuscar"
                [activeIndex]="0">
              </app-pedido-facturacion>

              <!-- Botones de navegación -->
              <div class="wizard-footer-container mt-4">
                <div class="d-flex justify-content-between">
                  <button class="btn btn-outline-secondary" type="button" awPreviousStep>
                    <i class="fa fa-arrow-left me-1"></i> Volver
                  </button>
                  <button class="btn btn-success" type="button" awNextStep (click)="reviewStepAndExecute(5)"
                    [disabled]="!pedidoGral?.facturacion">
                    <i class="fa fa-check-circle me-1"></i> Resumen y Pago
                  </button>
                </div>
                <div *ngIf="!pedidoGral?.facturacion" class="alert alert-warning mt-3 small">
                  <i class="fa fa-exclamation-triangle me-2"></i>
                  Debe seleccionar datos de facturación para continuar
                </div>
              </div>
            </aw-wizard-step>

            <!-- PASO 6: RESUMEN Y PAGO -->
            <aw-wizard-step [navigationSymbol]="{ symbol: '6' }">
              <ng-template awWizardStepSymbol>
                <div class="f1-step">
                  <div class="f1-step-icon"><i class="fa fa-credit-card"></i></div>
                  <p class="text-steper">Pago</p>
                </div>
              </ng-template>
              
              <app-checkout #resumen [pedido]="pedidoGral" [allBillingZone]="allBillingZone" 
                (comprarYPagar)="comprarYPagar($event)"></app-checkout>

              <!-- Botones de navegación -->
              <div class="wizard-footer-container mt-4">
                <div class="d-flex justify-content-between">
                  <button class="btn btn-outline-secondary" type="button" awPreviousStep>
                    <i class="fa fa-arrow-left me-1"></i> Volver
                  </button>
                  <button class="btn btn-primary" type="button" (click)="prepararPago()">
                    <i class="fa fa-money-bill-wave me-1"></i> Procesar Pago
                  </button>
                </div>
              </div>
            </aw-wizard-step>

            <!-- PASO 7: CONFIRMACIÓN DEL PEDIDO -->
            <aw-wizard-step [navigationSymbol]="{ symbol: '7' }">
              <ng-template awWizardStepSymbol>
                <div class="f1-step">
                  <div class="f1-step-icon"><i class="fa fa-check-circle"></i></div>
                  <p class="text-steper">Confirmación</p>
                </div>
              </ng-template>
              
              <!-- Contenido de confirmación del pedido -->
              <div *ngIf="showPedidoConfirm" class="confirmation-container">
                <div class="card shadow-sm border-success">
                  <div class="card-header bg-success text-white">
                    <div class="d-flex justify-content-between align-items-center">
                      <h4 class="mb-0"><i class="fa fa-check-circle me-2"></i>¡Pedido Procesado Exitosamente!</h4>
                      <div>
                        <span class="badge bg-light text-dark">Pedido #{{pedidoGral?.nroPedido}}</span>
                      </div>
                    </div>
                  </div>
                  <div class="card-body">
                    <!-- Componente de confirmación que muestra el HTML del pedido -->
                    <app-confirm [pedido]="pedidoGral"></app-confirm>
                  </div>
                </div>
              </div>
            </aw-wizard-step>

          </aw-wizard>
        </div>
      </div>
    </div>
  </div>
</div>
<ng-template #entrega let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Crear Datos de Entrega</h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="row">
      <div class="col-sm-12">
        <label class="form-label" for="alias_entrega">Referencia Para Datos de Entrega</label>
        <input class="form-control" type="text" id="alias_entrega" [(ngModel)]="alias_entrega" />
      </div>
    </div>

    <div class="row">
      <div class="col-sm-3">
        <label class="form-label" for="nombres_entrega">Nombres:</label>
      </div>
      <div class="col-sm-3">
        <label class="form-label" for="nombres_entrega">Apellidos:</label>
      </div>

      <div class="col-sm-6">
        <label class="form-label" for="indicativo_entrega">Número de Celular:</label>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-3">
        <input class="form-control" type="text" id="nombres_entrega" [(ngModel)]="nombres_entrega" />
      </div>
      <div class="col-sm-3">
        <input class="form-control" type="text" id="apellidos_entrega" [(ngModel)]="apellidos_entrega" />
      </div>

      <div class="col-sm-3 mb-3">
        <select autocomplete="on" [(ngModel)]="indicativo_celular_entrega" class="form-control select-default"
          id="validationCustom01" type="number" required="">
          <option disabled>Indicativo Celular</option>
          <option value="57" selected>Colombia (+57)</option>
          <option value="{{ item.phone_code }}" *ngFor="let item of indicativos">
            {{ item.nombre }} (+{{ item.phone_code }})
          </option>
        </select>
      </div>
      <div class="col-sm-3">
        <input class="form-control" type="text" id="numero_celular_entrega" [(ngModel)]="numero_celular_entrega" />
      </div>
    </div>
    <div class="row">
      <div class="col-sm-6">
        <label class="form-label" for="otro_numero_entrega">Agregar Otro Número:</label>
      </div>

      <div class="col-sm-6">
        <label class="form-label" for="direccion_entrega">Dirección:</label>
      </div>
    </div>

    <div class="row">
      <div class="col-sm-3">
        <select autocomplete="on" [(ngModel)]="indicativo_celular_entrega2" class="form-control select-default"
          id="validationCustom01" type="number" required="">
          <option disabled>Indicativo Celular</option>
          <option value="57" selected>Colombia (+57)</option>
          <option value="{{ item.phone_code }}" *ngFor="let item of indicativos">
            {{ item.nombre }} (+{{ item.phone_code }})
          </option>
        </select>
      </div>
      <div class="col-sm-3">
        <input class="form-control" type="text" id="otro_numero_entrega" [(ngModel)]="otro_numero_entrega" />
      </div>
      <div class="col-sm-6">
        <input class="form-control" type="text" id="direccion_entrega" [(ngModel)]="direccion_entrega" />
      </div>
    </div>
    <div class="row">
      <div class="col-sm-6">
        <label class="form-label" for="observaciones">Nombre de la Unidad o Edificio</label>
        <input class="form-control" type="text" id="codigo_postal_entrega" [(ngModel)]="nombreUnidad" />
      </div>
      <div class="col-sm-6">
        <label class="form-label" for="observaciones">Especificaciones Internas: Torre, Apto, Oficina</label>
        <input class="form-control" type="text" id="especificaciones_internas" [(ngModel)]="especificacionesInternas" />
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12">
        <label class="form-label" for="observaciones">Observaciones Adicionales / Generales para la entrega:</label>
        <textarea class="form-control" id="observaciones" [(ngModel)]="observaciones"></textarea>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12">
        <label class="form-label" for="observaciones">Barrio/Sector</label>
        <input class="form-control" type="text" id="codigo_postal_entrega" [(ngModel)]="barrio" />
      </div>
    </div>
    <div class="row">
      <div class="col-sm-4 mb-3">
        <label class="form-label" for="validationCustom01">País</label>
        <select [(ngModel)]="pais_entrega" class="form-control select-default" name="" id=""
          (change)="identificarDepto1()">
          <option disabled selected>País</option>
          <option *ngFor="let item of paises" value="{{ item }}">
            {{ item }}
          </option>
        </select>
      </div>
      <div class="col-md-4 mb-3">
        <label class="form-label" for="validationCustom01">Departamento</label>
        <select [(ngModel)]="departamento_entrega" class="form-control select-default" id="validationCustom01"
          type="text" placeholder="Departamento" required="" (change)="identificarCiu1()">
          <option disabled selected>Departamento</option>
          <option *ngFor="let item of departamentos1" value="{{ item }}">
            {{ item }}
          </option>
        </select>
      </div>
      <div class="col-md-4 mb-3">
        <label class="form-label" for="validationCustom01">Ciudad</label>
        <select [(ngModel)]="ciudad_municipio_entrega" class="form-control select-default" id="validationCustom01"
          type="text" placeholder="Ciudad" required="" (change)="idBillingZone('')">
          <option disabled selected>Ciudad / Municipio</option>
          <option *ngFor="let item of ciudades1" value="{{ item }}">
            {{ item }}
          </option>
        </select>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-4">
        <label class="form-label" for="validationCustom01">Zona Cobro</label>
      </div>
      <div class="col-sm-4">
        <label class="form-label" for="codigo_postal_entrega">Código Postal:</label>
      </div>
    </div>
    <div class="row">
      <div class="col-md-4 mb-3">
        <select class="form-control select-default" [(ngModel)]="zona_cobro" id="validationCustom01" type="text"
          placeholder="Zona Cobro" required="">
          <option disabled selected>
            Zona Cobro
          </option>
          <option *ngFor="let item of filteredResults" value="{{ item.nombreZonaCobro }}">
            {{ item.nombreZonaCobro}} ({{item.valorZonaCobro | currency}})
          </option>
        </select>
      </div>
      <div class="col-md-4">
        <input class="form-control" type="text" id="codigo_postal_entrega" [(ngModel)]="codigo_postal_entrega" />
      </div>
      <div class="col-md-4 mb-3">
        <button class="btn btn-primary" (click)="redirectToPostalCode()">
          Conoce Tu Codigo Postal
        </button>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button *ngIf="editandodato" type="button" class="btn btn-outline-dark" (click)="editarDatosEntrega()">
      Guardar
    </button>
  </div>
</ng-template>
<ng-template #facturacion let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">
      Crear Datos Facturacion Electrónica
    </h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="row">
      <div class="col-sm-6">
        <label class="form-label" for="razon_social">Referencia para guardar datos:</label>
        <input placeholder="Ej: Factura para compras de la empresa" class="form-control" type="text" id="razon_social"
          [(ngModel)]="alias_facturacion" />
      </div>
      <div class="col-sm-6">
        <label class="form-label" for="razon_social">Razón Social / Nombre Completo:</label>
        <input class="form-control" type="text" id="razon_social" [(ngModel)]="razon_social" />
      </div>
    </div>
    <div class="row">
      <div class="col-sm-6">
        <label class="form-label" for="tipo_documento_facturacion">Tipo de Documento:</label>
        <select class="form-control" id="tipo_documento_facturacion" [(ngModel)]="tipo_documento_facturacion">
          <option value="CC-NIT">Cedula de Ciudadania</option>
          <option value="PA">PA</option>
          <option value="TI">TI</option>
          <option value="NIT">NIT</option>
        </select>
      </div>
      <div class="col-sm-6">
        <label class="form-label" for="tipo_documento_facturacion">Documento:</label>
        <input class="form-control" type="text" id="numero_documento_facturacion"
          [(ngModel)]="numero_documento_facturacion" />
      </div>
    </div>
    <div class="row">
      <div class="col-sm-6">
        <label class="form-label" for="indicativo">Número de Celular:</label>
      </div>
      <div class="col-sm-6">
        <label class="form-label" for="correo_electronico">Correo Electrónico:</label>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-3 mb-3">
        <select autocomplete="on" [(ngModel)]="indicativo_celular_facturacion" class="form-control select-default"
          id="validationCustom01" type="number" required="">
          <option disabled>Indicativo Celular</option>
          <option value="57" selected>Colombia (+57)</option>
          <option value="{{ item.phone_code }}" *ngFor="let item of indicativos">
            {{ item.nombre }} (+{{ item.phone_code }})
          </option>
        </select>
      </div>
      <div class="col-sm-3">
        <input class="form-control" type="text" id="numero_celular" [(ngModel)]="numero_celular_facturacion" />
      </div>
      <div class="col-sm-6">
        <input class="form-control" type="email" id="correo_electronico" [(ngModel)]="correo_electronico_facturacion" />
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12">
        <label class="form-label" for="direccion">Dirección del Comprador:</label>
        <input class="form-control" type="text" id="direccion" [(ngModel)]="direccion_facturacion" />
      </div>
      <div class="col-sm-4 mb-3">
        <label class="form-label" for="validationCustom01">País</label>
        <select [(ngModel)]="pais" class="form-control select-default" name="" id="" (change)="identificarDepto()">
          <option disabled selected>País</option>
          <option *ngFor="let item of paises" value="{{ item }}">
            {{ item }}
          </option>
        </select>
      </div>
      <div class="col-md-4 mb-3">
        <label class="form-label" for="validationCustom01">Departamento</label>
        <select [(ngModel)]="departamento" class="form-control select-default" id="validationCustom01" type="text"
          placeholder="Departamento" required="" (change)="identificarCiu()">
          <option disabled selected>Departamento</option>
          <option *ngFor="let item of departamentos" value="{{ item }}">
            {{ item }}
          </option>
        </select>
      </div>
      <div class="col-md-4 mb-3">
        <label class="form-label" for="validationCustom01">Ciudad</label>
        <select [(ngModel)]="ciudad_municipio" class="form-control select-default" id="validationCustom01" type="text"
          placeholder="Ciudad" required="">
          <option disabled selected>Ciudad / Municipio</option>
          <option *ngFor="let item of ciudades" value="{{ item }}">
            {{ item }}
          </option>
        </select>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-4">
        <label class="form-label" for="codigo_postal">Código Postal:</label>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-4">
        <input class="form-control" type="text" id="codigo_postal" [(ngModel)]="codigo_postal" />
      </div>
      <div class="col-md-4 mb-3">
        <button class="btn btn-primary" (click)="redirectToPostalCode()">
          Conoce Tu Codigo Postal
        </button>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" *ngIf="editandodato" class="btn btn-outline-dark" (click)="editarDatosFacturacion()">
      Guardar
    </button>
  </div>
</ng-template>
<!-- Añadimos el componente de voz al final del template para que se muestre como botón flotante -->
<!-- <app-voice-interaction (transcriptionEvent)="onVoiceTranscription($event)"></app-voice-interaction> -->