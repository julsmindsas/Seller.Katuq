<!-- <app-breadcrumb [title]="'Ventas'" [items]="['Ventas/Crear Ventas']" [active_item]="'Crear Ventas'"></app-breadcrumb> -->
<div class="container-fluid">
  <div class="row">
    <div class="col-sm-12">
      <div class="card border-0 shadow-sm">
        <!-- Header con información de venta -->
        <div class="card-header p-4 bg-primary text-white">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h4 class="mb-1"><i class="fa fa-shopping-cart me-2"></i>Crear Venta</h4>
              <p class="mb-0 opacity-75">Preventa # {{pedidoGral.nroPedido}}</p>
              <p *ngIf="pedidoGral?.cliente" class="mb-0 opacity-75">
                <i class="fa fa-user me-1"></i> {{pedidoGral?.cliente.nombres_completos}} {{pedidoGral?.cliente.apellidos_completos}}
              </p>
            </div>
            <div class="d-none d-md-block">
              <span class="badge bg-light text-dark p-2 rounded-pill">
                <i class="fa fa-calendar me-1"></i> {{maxDate | date:'dd/MM/yyyy'}}
              </span>
            </div>
          </div>
        </div>

        <div class="card-body p-0">
          <!-- Asistente de pasos mejorado -->
          <aw-wizard #wizard id="wizard" name="wizard" *ngIf="showSteper" navBarLayout="large-filled-symbols" 
                    class="wizard-modern">
            <!-- PASO 1: CATÁLOGO -->
            <aw-wizard-step [navigationSymbol]="{ symbol: '1' }">
              <ng-template awWizardStepSymbol>
                <div class="wizard-step-container">
                  <div class="wizard-step-icon bg-primary text-white">
                    <i class="fa fa-th-large"></i>
                  </div>
                  <p class="wizard-step-text">Catálogo</p>
                </div>
              </ng-template>
              
              <div class="container-fluid p-4">
                <!-- Selección de ubicación -->
                <div class="card mb-4 border-0 shadow-sm">
                  <div class="card-header bg-light p-3">
                    <h5 class="mb-0"><i class="fa fa-map-marker me-2"></i>Ubicación de entrega</h5>
                  </div>
                  <div class="card-body">
                    <div class="row">
                      <div class="col-md-6 mx-auto">
                        <label class="form-label fw-medium" for="ciudad">Seleccione la ciudad de destino:</label>
                        <div class="input-group">
                          <span class="input-group-text bg-light">
                            <i class="fa fa-map-marker"></i>
                          </span>
                          <select (change)="onSelectCity($event)" class="form-select" id="ciudad">
                            <option value="seleccione">Seleccione una ciudad</option>
                            <option *ngFor="let ciudad of empresaActual?.ciudadess?.ciudadesEntrega" [value]="ciudad.value">
                              {{ ciudad.label }}
                            </option>
                          </select>
                        </div>
                        <small class="form-text text-muted">La disponibilidad de productos puede variar según la ubicación</small>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Vista del catálogo -->
                <div class="mb-3 d-flex justify-content-between align-items-center">
                  <div>
                    <h5 class="mb-0">Productos disponibles</h5>
                    <p class="text-muted small mb-0">Seleccione los productos para su venta</p>
                  </div>
                  <div class="btn-group" role="group">
                    <button type="button" class="btn" [class.btn-primary]="!listView" [class.btn-outline-primary]="listView" (click)="listView = false">
                      <i class="fa fa-th-large me-1"></i> Grid
                    </button>
                    <button type="button" class="btn" [class.btn-primary]="listView" [class.btn-outline-primary]="!listView" (click)="listView = true">
                      <i class="fa fa-list me-1"></i> Lista
                    </button>
                  </div>
                </div>
                
                <app-ecomerce-products #products></app-ecomerce-products>
                
                <!-- Botones de navegación -->
                <div class="d-flex justify-content-end mt-4">
                  <button class="btn btn-lg btn-primary" type="button" awNextStep
                    [disabled]="!(pedidoGral?.carrito && pedidoGral.carrito.length > 0)"
                    ngbTooltip="Continuar al Carrito" placement="top">
                    <i class="fa fa-shopping-cart me-2"></i> Continuar al Carrito
                    <span class="badge bg-white text-primary ms-2 rounded-circle" *ngIf="pedidoGral?.carrito && pedidoGral.carrito.length > 0">
                      {{pedidoGral.carrito.length}}
                    </span>
                  </button>
                </div>
              </div>
            </aw-wizard-step>

            <!-- PASO 2: CARRITO Y NOTAS -->
            <aw-wizard-step (stepEnter)="enterStep($event,5)">
              <ng-template awWizardStepSymbol>
                <div class="wizard-step-container">
                  <div class="wizard-step-icon bg-primary text-white">
                    <i class="fa fa-shopping-cart"></i>
                  </div>
                  <p class="wizard-step-text">Carrito</p>
                </div>
              </ng-template>
              
              <div class="container-fluid p-4">
                <div class="row">
                  <!-- Carrito -->
                  <div class="col-lg-8">
                    <app-carrito #carrito [pedido]="pedidoGral"></app-carrito>
                  </div>
                  
                  <!-- Notas y resumen -->
                  <div class="col-lg-4">
                    <app-notas #notaspedidos [pedido]="pedidoGral" [carrito]="carrito1"></app-notas>
                  </div>
                </div>
                
                <!-- Botones de navegación -->
                <div class="d-flex justify-content-between mt-4">
                  <button class="btn btn-outline-secondary" type="button" awPreviousStep>
                    <i class="fa fa-arrow-left me-2"></i> Volver al Catálogo
                  </button>
                  <button class="btn btn-lg btn-primary" type="button" awNextStep>
                    <i class="fa fa-user me-2"></i> Continuar a Datos Cliente
                  </button>
                </div>
              </div>
            </aw-wizard-step>

            <!-- PASO 3: DATOS CLIENTE -->
            <aw-wizard-step [navigationSymbol]="{ symbol: '3' }">
              <ng-template awWizardStepSymbol>
                <div class="wizard-step-container">
                  <div class="wizard-step-icon bg-primary text-white">
                    <i class="fa fa-user"></i>
                  </div>
                  <p class="wizard-step-text">Cliente</p>
                </div>
              </ng-template>
              
              <div class="container-fluid p-4">
                <!-- Búsqueda de cliente -->
                <div class="card border-0 shadow-sm mb-4">
                  <div class="card-header bg-light p-3">
                    <h5 class="mb-0"><i class="fa fa-search me-2"></i>Buscar Cliente</h5>
                  </div>
                  <div class="card-body">
                    <div class="row g-3">
                      <div class="col-md-4">
                        <label class="form-label fw-medium" for="tipo_documento">Buscar por:</label>
                        <select #buscarPor class="form-select" id="tipo_documento">
                          <option value="CC-NIT" selected>CC-NIT</option>
                          <option value="PA">Email</option>
                          <option value="TI">Nombre Apellido</option>
                        </select>
                      </div>
                      <div class="col-md-5">
                        <label class="form-label fw-medium" for="numero_documento">Ingrese el valor:</label>
                        <div class="input-group">
                          <span class="input-group-text bg-light">
                            <i class="fa fa-search"></i>
                          </span>
                          <input #documentoBusqueda class="form-control" type="text" id="numero_documento"
                            placeholder="Escriba para buscar" />
                        </div>
                      </div>
                      <div class="col-md-3 d-flex align-items-end">
                        <button class="btn btn-primary w-100" (click)="buscar()">
                          <i class="fa fa-search me-2"></i> Buscar
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Cliente encontrado -->
                <div *ngIf="encontrado" class="card border-success border-top border-3 shadow-sm mb-4">
                  <div class="card-body p-3">
                    <div class="row align-items-center">
                      <div class="col-md-8">
                        <div class="d-flex align-items-center">
                          <div class="avatar-circle bg-success text-white me-3">
                            {{pedidoGral.cliente?.nombres_completos?.charAt(0) || 'C'}}
                          </div>
                          <div>
                            <h5 class="mb-1">{{ pedidoGral.cliente?.nombres_completos }} {{ pedidoGral.cliente?.apellidos_completos }}</h5>
                            <p class="text-muted mb-0 small">
                              <i class="fa fa-id-card me-1"></i> {{ pedidoGral.cliente?.tipo_documento_comprador }} {{ pedidoGral.cliente?.documento }}
                            </p>
                            <p class="text-muted mb-0 small">
                              <i class="fa fa-phone me-1"></i> {{ pedidoGral.cliente?.indicativo_celular_comprador }} {{ pedidoGral.cliente?.numero_celular_comprador }}
                            </p>
                            <p class="text-muted mb-0 small">
                              <i class="fa fa-envelope me-1"></i> {{ pedidoGral.cliente?.correo_electronico_comprador }}
                            </p>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-4 text-md-end mt-3 mt-md-0">
                        <button class="btn btn-outline-success" (click)="mostrarFormularioCliente = true">
                          <i class="fa fa-edit me-1"></i> Editar Información
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Formulario de cliente -->
                <div *ngIf="mostrarFormularioCliente" class="card border-0 shadow-sm mb-4">
                  <div class="card-header bg-light p-3">
                    <h5 class="mb-0">{{ encontrado ? 'Editar Cliente' : 'Crear Nuevo Cliente' }}</h5>
                  </div>
                  <div class="card-body">
                    <form [formGroup]="formulario">
                      <!-- Información personal -->
                      <div class="row g-3 mb-4">
                        <div class="col-12">
                          <h6 class="border-bottom pb-2 mb-3 text-primary">Información Personal</h6>
                        </div>
                        <div class="col-md-3">
                          <label class="form-label fw-medium" for="tipo_documento">
                            Tipo de Documento <span class="text-danger">*</span>
                          </label>
                          <select class="form-select" id="tipo_documento" formControlName="tipo_documento_comprador">
                            <option value="CC-NIT">CC-NIT</option>
                            <option value="PA">PA</option>
                            <option value="TI">TI</option>
                          </select>
                        </div>
                        <div class="col-md-3">
                          <label class="form-label fw-medium" for="numero_documento">
                            Documento <span class="text-danger">*</span>
                          </label>
                          <input class="form-control" type="text" id="numero_documento" formControlName="documento" />
                        </div>
                        <div class="col-md-6">
                          <label class="form-label fw-medium" for="nombres">
                            Nombres y Apellidos <span class="text-danger">*</span>
                          </label>
                          <input class="form-control" type="text" id="nombres" formControlName="nombres_completos" />
                        </div>
                      </div>

                      <!-- Información de contacto -->
                      <div class="row g-3 mb-4">
                        <div class="col-12">
                          <h6 class="border-bottom pb-2 mb-3 text-primary">Información de Contacto</h6>
                        </div>
                        <div class="col-md-6">
                          <label class="form-label fw-medium">Teléfono Celular <span class="text-danger">*</span></label>
                          <div class="input-group">
                            <span class="input-group-text bg-light" style="min-width: 90px;">
                              <select autocomplete="on" formControlName="indicativo_celular_comprador"
                                class="form-select form-select-sm border-0 bg-transparent">
                                <option value="57" selected>+57</option>
                                <option value="{{ item.phone_code }}" *ngFor="let item of indicativos">
                                  +{{ item.phone_code }}
                                </option>
                              </select>
                            </span>
                            <input class="form-control" type="text" formControlName="numero_celular_comprador"
                              placeholder="Número de celular" />
                          </div>
                        </div>
                        <div class="col-md-6">
                          <label class="form-label fw-medium" for="correo_electronico">
                            Correo Electrónico <span class="text-danger">*</span>
                          </label>
                          <div class="input-group">
                            <span class="input-group-text bg-light">
                              <i class="fa fa-envelope-o"></i>
                            </span>
                            <input class="form-control" type="email" id="correo_electronico"
                              placeholder="ejemplo@correo.com" formControlName="correo_electronico_comprador" />
                          </div>
                        </div>
                        <div class="col-12">
                          <div class="form-check form-switch">
                            <input #whatsapp type="checkbox" class="form-check-input" id="sameAsPhone"
                              (change)="replicarWhatsApp($event)">
                            <label class="form-check-label" for="sameAsPhone">
                              Usar el mismo número para WhatsApp
                            </label>
                          </div>
                        </div>
                        <div class="col-md-6" *ngIf="!whatsapp.checked">
                          <label class="form-label fw-medium">WhatsApp</label>
                          <div class="input-group">
                            <span class="input-group-text bg-light" style="min-width: 90px;">
                              <select autocomplete="on" formControlName="indicativo_celular_whatsapp"
                                class="form-select form-select-sm border-0 bg-transparent">
                                <option value="57" selected>+57</option>
                                <option value="{{ item.phone_code }}" *ngFor="let item of indicativos">
                                  +{{ item.phone_code }}
                                </option>
                              </select>
                            </span>
                            <input class="form-control" type="text" formControlName="numero_celular_whatsapp"
                              placeholder="Número de WhatsApp" />
                            <span class="input-group-text bg-success text-white">
                              <i class="fa fa-whatsapp"></i>
                            </span>
                          </div>
                        </div>
                      </div>

                      <!-- Dirección -->
                      <div class="row g-3 mb-4">
                        <div class="col-12">
                          <h6 class="border-bottom pb-2 mb-3 text-primary">Dirección Principal</h6>
                        </div>
                        <div class="col-md-12 mb-3">
                          <label class="form-label fw-medium" for="direccion">Dirección completa <span class="text-danger">*</span></label>
                          <div class="input-group">
                            <span class="input-group-text bg-light">
                              <i class="fa fa-map-marker"></i>
                            </span>
                            <input class="form-control" type="text" id="direccion" [(ngModel)]="direccion_facturacion"
                              [ngModelOptions]="{standalone: true}" placeholder="Ej: Calle 123 # 45-67" />
                          </div>
                        </div>
                        <div class="col-md-4">
                          <label class="form-label fw-medium" for="pais">País <span class="text-danger">*</span></label>
                          <select [(ngModel)]="pais" class="form-select" name="pais" id="pais"
                            [ngModelOptions]="{standalone: true}" (change)="identificarDepto()">
                            <option *ngFor="let item of paises" [value]="item" [selected]="item === 'Colombia'">{{ item }}</option>
                          </select>
                        </div>
                        <div class="col-md-4">
                          <label class="form-label fw-medium" for="departamento">Departamento <span class="text-danger">*</span></label>
                          <select [(ngModel)]="departamento" class="form-select" id="departamento"
                            [ngModelOptions]="{standalone: true}" (change)="identificarCiu()">
                            <option *ngFor="let item of departamentos" [value]="item" [selected]="item === 'Antioquia'">{{ item }}</option>
                          </select>
                        </div>
                        <div class="col-md-4">
                          <label class="form-label fw-medium" for="ciudad">Ciudad <span class="text-danger">*</span></label>
                          <select [(ngModel)]="ciudad_municipio" class="form-select" id="ciudad"
                            [ngModelOptions]="{standalone: true}">
                            <option *ngFor="let item of ciudades" [value]="item">{{ item }}</option>
                          </select>
                        </div>
                      </div>

                      <!-- Botones de acción -->
                      <div class="d-flex justify-content-end mt-4">
                        <button *ngIf="!encontrado" class="btn btn-warning btn-lg" 
                               (click)="crearClienteRapido()" [disabled]="formulario.invalid">
                          <i class="fa fa-bolt me-2"></i> Crear Cliente Rápido
                        </button>
                        <button *ngIf="encontrado" class="btn btn-primary btn-lg" 
                               (click)="editarCliente()" [disabled]="formulario.invalid">
                          <i class="fa fa-save me-2"></i> Guardar Cambios
                        </button>
                      </div>
                    </form>
                  </div>
                </div>

                <!-- Facturación y Entrega con Tabs -->
                <div *ngIf="encontrado || clienteRecienCreado" class="card border-0 shadow-sm mb-4">
                  <div class="card-header bg-light p-3">
                    <div class="d-flex justify-content-between align-items-center">
                      <h5 class="mb-0"><i class="fa fa-file-text me-2"></i>Datos de Facturación y Entrega</h5>
                      <span class="badge bg-info text-white">Requerido</span>
                    </div>
                  </div>
                  <div class="card-body p-0">
                    <p-tabView styleClass="custom-tabs">
                      <p-tabPanel header="Facturación">
                        <div class="p-3">
                          <app-pedido-facturacion #facturacion [pedidoGral]="pedidoGral" [formulario]="formulario"
                            [datosFacturacionElectronica]="datosFacturacionElectronica"
                            [direccionFacturacion]="direccion_facturacion" [paisInicial]="pais"
                            [departamentoInicial]="departamento" [ciudad]="ciudad_municipio"
                            [codigoPostal]="codigo_postal" (overridePedido)="overridePedido($event)"
                            [generarFactura]="generaFacturaElectronica" [documentoBusqueda]="documentoBuscar"
                            [activeIndex]="0">
                          </app-pedido-facturacion>
                        </div>
                      </p-tabPanel>

                      <p-tabPanel header="Entrega" *ngIf="activarEntrega">
                        <div class="p-3">
                          <div *ngIf="datosEntregaNoEncontradosParaCiudadSeleccionada"
                            class="alert alert-warning d-flex align-items-center mb-4">
                            <i class="fa fa-exclamation-triangle me-3 fa-2x"></i>
                            <div>
                              No se encontraron datos de entrega para la ciudad seleccionada.
                              <strong>Por favor cree uno nuevo para continuar.</strong>
                            </div>
                          </div>
                          <pedido-entrega #entrega [pedidoGral]="pedidoGral" [formulario]="formulario"
                            [datosEntregas]="datosEntregas" [documentoBusqueda]="documentoBuscar"
                            [direccionEntrega]="direccion_facturacion" [paisInicial]="pais"
                            [departamentoInicial]="departamento" [ciudad]="ciudad_municipio"
                            [codigoPostal]="codigo_postal"
                            [datosEntregaNoEncontradosParaCiudadSeleccionada]="datosEntregaNoEncontradosParaCiudadSeleccionada"
                            (overridePedido)="overridePedido($event)" [activeIndex]="0">
                          </pedido-entrega>
                        </div>
                      </p-tabPanel>
                    </p-tabView>
                  </div>
                </div>
                
                <!-- Mensaje informativo -->
                <div *ngIf="mostrarFormularioCliente && !encontrado && !clienteRecienCreado"
                  class="alert alert-info d-flex align-items-center">
                  <i class="fa fa-info-circle me-3 fa-2x"></i>
                  <div>
                    <strong>Información:</strong> Para continuar con la facturación y entrega, primero debe crear el cliente.
                  </div>
                </div>

                <!-- Botones de navegación -->
                <div class="d-flex justify-content-between mt-4" *ngIf="pedidoGral.cliente != null">
                  <button class="btn btn-outline-secondary" type="button" awPreviousStep>
                    <i class="fa fa-arrow-left me-2"></i> Volver al Carrito
                  </button>
                  <button class="btn btn-lg btn-primary" type="button" awNextStep
                    [disabled]="!(pedidoGral?.facturacion && pedidoGral?.envio)">
                    <i class="fa fa-credit-card me-2"></i> Continuar al Pago
                  </button>
                </div>
                
                <div *ngIf="!(pedidoGral?.facturacion && pedidoGral?.envio) && (encontrado || clienteRecienCreado)" 
                     class="alert alert-warning mt-3 d-flex align-items-center">
                  <i class="fa fa-exclamation-triangle me-3"></i>
                  <div>
                    Debe seleccionar o crear los datos de <strong>Facturación y Entrega</strong> para continuar.
                  </div>
                </div>
              </div>
            </aw-wizard-step>
            
            <!-- PASO 4: RESUMEN Y PAGO -->
            <aw-wizard-step (stepEnter)="enterStep($event,7)">
              <ng-template awWizardStepSymbol>
                <div class="wizard-step-container">
                  <div class="wizard-step-icon bg-primary text-white">
                    <i class="fa fa-credit-card"></i>
                  </div>
                  <p class="wizard-step-text">Pago</p>
                </div>
              </ng-template>
              
              <div class="container-fluid p-4">
                <!-- Checkout -->
                <app-checkout #resumen [pedido]="pedidoGral" [allBillingZone]="allBillingZone"
                  (comprarYPagar)="comprarYPagar($event)"></app-checkout>
                
                <!-- Información adicional de confianza -->
                <div class="row mt-4">
                  <div class="col-md-4 mb-3">
                    <div class="card border-0 shadow-sm h-100">
                      <div class="card-body text-center p-4">
                        <i class="fa fa-lock fa-2x text-success mb-3"></i>
                        <h5>Pago Seguro</h5>
                        <p class="mb-0 text-muted">Todas las transacciones están protegidas con cifrado SSL</p>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4 mb-3">
                    <div class="card border-0 shadow-sm h-100">
                      <div class="card-body text-center p-4">
                        <i class="fa fa-truck fa-2x text-primary mb-3"></i>
                        <h5>Envío Confiable</h5>
                        <p class="mb-0 text-muted">Seguimiento de pedidos en tiempo real</p>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4 mb-3">
                    <div class="card border-0 shadow-sm h-100">
                      <div class="card-body text-center p-4">
                        <i class="fa fa-headphones fa-2x text-warning mb-3"></i>
                        <h5>Soporte 24/7</h5>
                        <p class="mb-0 text-muted">Estamos aquí para ayudarte en cualquier momento</p>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Botones de navegación -->
                <div class="d-flex justify-content-between mt-4">
                  <button class="btn btn-outline-secondary" type="button" awPreviousStep>
                    <i class="fa fa-arrow-left me-2"></i> Volver a Datos Cliente
                  </button>
                </div>
              </div>
            </aw-wizard-step>
            
            <!-- PASO 5: CONFIRMACIÓN -->
            <aw-wizard-completion-step awEnableBackLinks>
              <ng-template awWizardStepSymbol>
                <div class="wizard-step-container">
                  <div class="wizard-step-icon bg-success text-white">
                    <i class="fa fa-check"></i>
                  </div>
                  <p class="wizard-step-text">Confirmación</p>
                </div>
              </ng-template>
              
              <div class="container-fluid p-4">
                <div class="text-center py-5">
                  <div class="check-circle mb-4">
                    <i class="fa fa-check-circle fa-5x text-success"></i>
                  </div>
                  <h2 class="mb-3">¡Pedido Completado!</h2>
                  <p class="mb-4 lead">Tu pedido ha sido procesado correctamente.</p>
                  <div class="row justify-content-center">
                    <div class="col-md-6">
                      <div class="card border-0 shadow-sm mb-4">
                        <div class="card-body text-center">
                          <h5 class="mb-3">Número de Pedido</h5>
                          <p class="h3 text-primary mb-0">{{pedidoGral.nroPedido}}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                  <button class="btn btn-lg btn-primary" routerLink="/ventas/lista">
                    <i class="fa fa-list me-2"></i> Ver Mis Pedidos
                  </button>
                </div>
              </div>
            </aw-wizard-completion-step>
          </aw-wizard>
          
          <!-- Confirmación -->
          <app-confirm *ngIf="showPedidoConfirm" [pedido]="pedidoGral"></app-confirm>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modales y Templates -->
<ng-template #entrega let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Crear Datos de Entrega</h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="row">
      <div class="col-sm-12">
        <label class="form-label" for="alias_entrega">Referencia Para Datos de Entrega</label>
        <input class="form-control" type="text" id="alias_entrega" [(ngModel)]="alias_entrega" />
      </div>
    </div>

    <div class="row">
      <div class="col-sm-3">
        <label class="form-label" for="nombres_entrega">Nombres:</label>
      </div>
      <div class="col-sm-3">
        <label class="form-label" for="nombres_entrega">Apellidos:</label>
      </div>

      <div class="col-sm-6">
        <label class="form-label" for="indicativo_entrega">Número de Celular:</label>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-3">
        <input class="form-control" type="text" id="nombres_entrega" [(ngModel)]="nombres_entrega" />
      </div>
      <div class="col-sm-3">
        <input class="form-control" type="text" id="apellidos_entrega" [(ngModel)]="apellidos_entrega" />
      </div>

      <div class="col-sm-3 mb-3">
        <select autocomplete="on" [(ngModel)]="indicativo_celular_entrega" class="form-control select-default"
          id="validationCustom01" type="number" required="">
          <option disabled>Indicativo Celular</option>
          <option value="57" selected>Colombia (+57)</option>
          <option value="{{ item.phone_code }}" *ngFor="let item of indicativos">
            {{ item.nombre }} (+{{ item.phone_code }})
          </option>
        </select>
      </div>
      <div class="col-sm-3">
        <input class="form-control" type="text" id="numero_celular_entrega" [(ngModel)]="numero_celular_entrega" />
      </div>
    </div>
    <div class="row">
      <div class="col-sm-6">
        <label class="form-label" for="otro_numero_entrega">Agregar Otro Número:</label>
      </div>

      <div class="col-sm-6">
        <label class="form-label" for="direccion_entrega">Dirección:</label>
      </div>
    </div>

    <div class="row">
      <div class="col-sm-3">
        <select autocomplete="on" [(ngModel)]="indicativo_celular_entrega2" class="form-control select-default"
          id="validationCustom01" type="number" required="">
          <option disabled>Indicativo Celular</option>
          <option value="57" selected>Colombia (+57)</option>
          <option value="{{ item.phone_code }}" *ngFor="let item of indicativos">
            {{ item.nombre }} (+{{ item.phone_code }})
          </option>
        </select>
      </div>
      <div class="col-sm-3">
        <input class="form-control" type="text" id="otro_numero_entrega" [(ngModel)]="otro_numero_entrega" />
      </div>
      <div class="col-sm-6">
        <input class="form-control" type="text" id="direccion_entrega" [(ngModel)]="direccion_entrega" />
      </div>
    </div>
    <div class="row">
      <div class="col-sm-6">
        <label class="form-label" for="observaciones">Nombre de la Unidad o Edificio</label>
        <input class="form-control" type="text" id="codigo_postal_entrega" [(ngModel)]="nombreUnidad" />
      </div>
      <div class="col-sm-6">
        <label class="form-label" for="observaciones">Especificaciones Internas: Torre, Apto, Oficina</label>
        <input class="form-control" type="text" id="especificaciones_internas" [(ngModel)]="especificacionesInternas" />
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12">
        <label class="form-label" for="observaciones">Observaciones Adicionales / Generales para la entrega:</label>
        <textarea class="form-control" id="observaciones" [(ngModel)]="observaciones"></textarea>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12">
        <label class="form-label" for="observaciones">Barrio/Sector</label>
        <input class="form-control" type="text" id="codigo_postal_entrega" [(ngModel)]="barrio" />
      </div>
    </div>
    <div class="row">
      <div class="col-sm-4 mb-3">
        <label class="form-label" for="validationCustom01">País</label>
        <select [(ngModel)]="pais_entrega" class="form-control select-default" name="" id=""
          (change)="identificarDepto1()">
          <option disabled selected>País</option>
          <option *ngFor="let item of paises" value="{{ item }}">
            {{ item }}
          </option>
        </select>
      </div>
      <div class="col-md-4 mb-3">
        <label class="form-label" for="validationCustom01">Departamento</label>
        <select [(ngModel)]="departamento_entrega" class="form-control select-default" id="validationCustom01"
          type="text" placeholder="Departamento" required="" (change)="identificarCiu1()">
          <option disabled selected>Departamento</option>
          <option *ngFor="let item of departamentos1" value="{{ item }}">
            {{ item }}
          </option>
        </select>
      </div>
      <div class="col-md-4 mb-3">
        <label class="form-label" for="validationCustom01">Ciudad</label>
        <select [(ngModel)]="ciudad_municipio_entrega" class="form-control select-default" id="validationCustom01"
          type="text" placeholder="Ciudad" required="" (change)="idBillingZone('')">
          <option disabled selected>Ciudad / Municipio</option>
          <option *ngFor="let item of ciudades1" value="{{ item }}">
            {{ item }}
          </option>
        </select>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-4">
        <label class="form-label" for="validationCustom01">Zona Cobro</label>
      </div>
      <div class="col-sm-4">
        <label class="form-label" for="codigo_postal_entrega">Código Postal:</label>
      </div>
    </div>
    <div class="row">
      <div class="col-md-4 mb-3">
        <select class="form-control select-default" [(ngModel)]="zona_cobro" id="validationCustom01" type="text"
          placeholder="Zona Cobro" required="">
          <option disabled selected>
            Zona Cobro
          </option>
          <option *ngFor="let item of filteredResults" value="{{ item.nombreZonaCobro }}">
            {{ item.nombreZonaCobro}} ({{item.valorZonaCobro | currency}})
          </option>
        </select>
      </div>
      <div class="col-md-4">
        <input class="form-control" type="text" id="codigo_postal_entrega" [(ngModel)]="codigo_postal_entrega" />
      </div>
      <div class="col-md-4 mb-3">
        <button class="btn btn-primary" (click)="redirectToPostalCode()">
          Conoce Tu Codigo Postal
        </button>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button *ngIf="editandodato" type="button" class="btn btn-outline-dark" (click)="editarDatosEntrega()">
      Guardar
    </button>
  </div>
</ng-template>

<ng-template #facturacion let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">
      Crear Datos Facturacion Electrónica
    </h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="row">
      <div class="col-sm-6">
        <label class="form-label" for="razon_social">Referencia para guardar datos:</label>
        <input placeholder="Ej: Factura para compras de la empresa" class="form-control" type="text" id="razon_social"
          [(ngModel)]="alias_facturacion" />
      </div>
      <div class="col-sm-6">
        <label class="form-label" for="razon_social">Razón Social / Nombre Completo:</label>
        <input class="form-control" type="text" id="razon_social" [(ngModel)]="razon_social" />
      </div>
    </div>
    <div class="row">
      <div class="col-sm-6">
        <label class="form-label" for="tipo_documento_facturacion">Tipo de Documento:</label>
        <select class="form-control" id="tipo_documento_facturacion" [(ngModel)]="tipo_documento_facturacion">
          <option value="CC-NIT">Cedula de Ciudadania</option>
          <option value="PA">PA</option>
          <option value="TI">TI</option>
          <option value="NIT">NIT</option>
        </select>
      </div>
      <div class="col-sm-6">
        <label class="form-label" for="tipo_documento_facturacion">Documento:</label>
        <input class="form-control" type="text" id="numero_documento_facturacion"
          [(ngModel)]="numero_documento_facturacion" />
      </div>
    </div>
    <div class="row">
      <div class="col-sm-6">
        <label class="form-label" for="indicativo">Número de Celular:</label>
      </div>
      <div class="col-sm-6">
        <label class="form-label" for="correo_electronico">Correo Electrónico:</label>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-3 mb-3">
        <select autocomplete="on" [(ngModel)]="indicativo_celular_facturacion" class="form-control select-default"
          id="validationCustom01" type="number" required="">
          <option disabled>Indicativo Celular</option>
          <option value="57" selected>Colombia (+57)</option>
          <option value="{{ item.phone_code }}" *ngFor="let item of indicativos">
            {{ item.nombre }} (+{{ item.phone_code }})
          </option>
        </select>
      </div>
      <div class="col-sm-3">
        <input class="form-control" type="text" id="numero_celular" [(ngModel)]="numero_celular_facturacion" />
      </div>
      <div class="col-sm-6">
        <input class="form-control" type="email" id="correo_electronico" [(ngModel)]="correo_electronico_facturacion" />
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12">
        <label class="form-label" for="direccion">Dirección del Comprador:</label>
        <input class="form-control" type="text" id="direccion" [(ngModel)]="direccion_facturacion" />
      </div>
      <div class="col-sm-4 mb-3">
        <label class="form-label" for="validationCustom01">País</label>
        <select [(ngModel)]="pais" class="form-control select-default" name="" id="" (change)="identificarDepto()">
          <option disabled selected>País</option>
          <option *ngFor="let item of paises" value="{{ item }}">
            {{ item }}
          </option>
        </select>
      </div>
      <div class="col-md-4 mb-3">
        <label class="form-label" for="validationCustom01">Departamento</label>
        <select [(ngModel)]="departamento" class="form-control select-default" id="validationCustom01" type="text"
          placeholder="Departamento" required="" (change)="identificarCiu()">
          <option disabled selected>Departamento</option>
          <option *ngFor="let item of departamentos" value="{{ item }}">
            {{ item }}
          </option>
        </select>
      </div>
      <div class="col-md-4 mb-3">
        <label class="form-label" for="validationCustom01">Ciudad</label>
        <select [(ngModel)]="ciudad_municipio" class="form-control select-default" id="validationCustom01" type="text"
          placeholder="Ciudad" required="">
          <option disabled selected>Ciudad / Municipio</option>
          <option *ngFor="let item of ciudades" value="{{ item }}">
            {{ item }}
          </option>
        </select>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-4">
        <label class="form-label" for="codigo_postal">Código Postal:</label>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-4">
        <input class="form-control" type="text" id="codigo_postal" [(ngModel)]="codigo_postal" />
      </div>
      <div class="col-md-4 mb-3">
        <button class="btn btn-primary" (click)="redirectToPostalCode()">
          Conoce Tu Codigo Postal
        </button>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" *ngIf="editandodato" class="btn btn-outline-dark" (click)="editarDatosFacturacion()">
      Guardar
    </button>
  </div>
</ng-template>

<style>
  /* Estilos para mejorar la apariencia del wizard */
  .wizard-modern {
    --primary-color: #3f51b5;
    --success-color: #4caf50;
    --warning-color: #ff9800;
    --danger-color: #f44336;
  }
  
  .wizard-step-container {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  
  .wizard-step-icon {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    margin-bottom: 8px;
    box-shadow: 0 3px 5px rgba(0,0,0,0.1);
  }
  
  .wizard-step-text {
    font-weight: 500;
    margin: 0;
  }
  
  .avatar-circle {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    font-weight: bold;
  }
  
  .check-circle {
    animation: scaleIn 0.5s ease-in-out;
  }
  
  @keyframes scaleIn {
    0% { transform: scale(0.5); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
  }
  
  /* Estilos para los tabs */
  :host ::ng-deep .custom-tabs .p-tabview-nav {
    border: none;
    background: transparent;
  }
  
  :host ::ng-deep .custom-tabs .p-tabview-nav li .p-tabview-nav-link {
    border-radius: 4px 4px 0 0;
    border: 1px solid #dee2e6;
    background: #f8f9fa;
    padding: 0.75rem 1.25rem;
    font-weight: 500;
  }
  
  :host ::ng-deep .custom-tabs .p-tabview-nav li.p-highlight .p-tabview-nav-link {
    border-color: var(--primary-color);
    background: var(--primary-color);
    color: #fff;
  }
</style>
<!-- <app-voice-interaction (transcriptionEvent)="onVoiceTranscription($event)"></app-voice-interaction> -->