<!-- <app-breadcrumb [title]="'Ventas'" [items]="['Ventas/Crear Ventas']" [active_item]="'Crear Ventas'"></app-breadcrumb> -->
<div class="container-fluid">
  <div class="row">
    <div class="col-sm-12">
      <div class="card border-0 shadow-sm">
        <!-- Header con información de venta -->
        <div class="card-header p-4 bg-primary text-white">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h4 class="mb-1"><i class="fa fa-shopping-cart me-2"></i>Crear Venta</h4>
              <p class="mb-0 opacity-75">Preventa # {{pedidoGral.nroPedido}}</p>
              <p *ngIf="pedidoGral?.cliente" class="mb-0 opacity-75">
                <i class="fa fa-user me-1"></i> {{pedidoGral?.cliente.nombres_completos}}
                {{pedidoGral?.cliente.apellidos_completos}}
              </p>
            </div>
            <div class="d-none d-md-block">
              <span class="badge bg-light text-dark p-2 rounded-pill">
                <i class="fa fa-calendar me-1"></i> {{maxDate | date:'dd/MM/yyyy'}}
              </span>
            </div>
          </div>
        </div>

        <div class="card-body p-0">
          <!-- Asistente de pasos mejorado -->
          <aw-wizard #wizard id="wizard" name="wizard" *ngIf="showSteper" navBarLayout="large-filled-symbols"
            class="wizard-modern">
            <!-- PASO 1: CATÁLOGO -->
            <aw-wizard-step [navigationSymbol]="{ symbol: '1' }">
              <ng-template awWizardStepSymbol>
                <div class="wizard-step-container">
                  <div class="wizard-step-icon bg-primary text-white">
                    <i class="fa fa-th-large"></i>
                  </div>
                  <p class="wizard-step-text">Catálogo</p>
                </div>
              </ng-template>

              <div class="container-fluid p-4">
                <!-- Selección de ubicación -->
                <div class="card mb-4 border-0 shadow-sm">
                  <div class="card-header bg-light p-3">
                    <h5 class="mb-0"><i class="fa fa-map-marker me-2"></i>Ubicación de entrega</h5>
                  </div>
                  <div class="card-body">
                    <div class="row">
                      <div class="col-md-6 mx-auto">
                        <label class="form-label fw-medium" for="ciudad">Seleccione la ciudad de destino:</label>
                        <div class="input-group">
                          <span class="input-group-text bg-light">
                            <i class="fa fa-map-marker"></i>
                          </span>
                          <select (change)="onSelectCity($event)" class="form-select" id="ciudad">
                            <option value="seleccione">Seleccione una ciudad</option>
                            <option *ngFor="let ciudad of empresaActual?.ciudadess?.ciudadesEntrega"
                              [value]="ciudad.value">
                              {{ ciudad.label }}
                            </option>
                          </select>
                        </div>
                        <small class="form-text text-muted">La disponibilidad de productos puede variar según la
                          ubicación</small>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Vista del catálogo -->
                <div class="mb-3 d-flex justify-content-between align-items-center">
                  <div>
                    <h5 class="mb-0">Productos disponibles</h5>
                    <p class="text-muted small mb-0">Seleccione los productos para su venta</p>
                  </div>
                  <div class="btn-group" role="group">
                    <button type="button" class="btn" [class.btn-primary]="!listView"
                      [class.btn-outline-primary]="listView" (click)="listView = false">
                      <i class="fa fa-th-large me-1"></i> Grid
                    </button>
                    <button type="button" class="btn" [class.btn-primary]="listView"
                      [class.btn-outline-primary]="!listView" (click)="listView = true">
                      <i class="fa fa-list me-1"></i> Lista
                    </button>
                  </div>
                </div>

                <app-ecomerce-products #products></app-ecomerce-products>

                <!-- Botones de navegación -->
                <div class="d-flex justify-content-end mt-4">
                  <button class="btn btn-lg btn-primary" type="button" awNextStep
                    [disabled]="!(pedidoGral?.carrito && pedidoGral.carrito.length > 0)"
                    ngbTooltip="Continuar al Carrito" placement="top">
                    <i class="fa fa-shopping-cart me-2"></i> Continuar al Carrito
                    <span class="badge bg-white text-primary ms-2 rounded-circle"
                      *ngIf="pedidoGral?.carrito && pedidoGral.carrito.length > 0">
                      {{pedidoGral.carrito.length}}
                    </span>
                  </button>
                </div>
              </div>
            </aw-wizard-step>

            <!-- PASO 2: CARRITO Y NOTAS -->
            <aw-wizard-step (stepEnter)="enterStep($event,5)">
              <ng-template awWizardStepSymbol>
                <div class="wizard-step-container">
                  <div class="wizard-step-icon bg-primary text-white">
                    <i class="fa fa-shopping-cart"></i>
                  </div>
                  <p class="wizard-step-text">Carrito</p>
                </div>
              </ng-template>

              <div class="container-fluid p-4">
                <!-- Carrito -->
                <div class="row mb-4">
                  <div class="col-12">
                    <app-carrito #carrito [pedido]="pedidoGral"></app-carrito>
                  </div>
                </div>

                <!-- Notas -->
                <div class="row">
                  <div class="col-12">
                    <div class="card border-0 shadow-sm">
                      <div class="card-header bg-light p-3">
                        <h5 class="mb-0"><i class="fa fa-sticky-note me-2"></i>Notas del Pedido</h5>
                      </div>
                      <div class="card-body">
                        <app-notas #notaspedidos [pedido]="pedidoGral" [carrito]="carrito1"></app-notas>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Botones de navegación -->
                <div class="d-flex justify-content-between mt-4">
                  <button class="btn btn-outline-secondary" type="button" awPreviousStep>
                    <i class="fa fa-arrow-left me-2"></i> Volver al Catálogo
                  </button>
                  <button class="btn btn-lg btn-primary" type="button" awNextStep>
                    <i class="fa fa-credit-card me-2"></i> Continuar al Pago
                  </button>
                </div>
              </div>
            </aw-wizard-step>

            <!-- PASO 3: RESUMEN Y PAGO -->
            <aw-wizard-step (stepEnter)="enterStep($event,7)">
              <ng-template awWizardStepSymbol>
                <div class="wizard-step-container">
                  <div class="wizard-step-icon bg-primary text-white">
                    <i class="fa fa-credit-card"></i>
                  </div>
                  <p class="wizard-step-text">Pago</p>
                </div>
              </ng-template>

              <div class="container-fluid p-4">
                <!-- Checkout -->
                <app-checkout #resumen [pedido]="pedidoGral" [allBillingZone]="allBillingZone"
                  (comprarYPagar)="comprarYPagar($event)"></app-checkout>

                <!-- Información adicional de confianza -->
                <div class="row mt-4">
                  <div class="col-md-4 mb-3">
                    <div class="card border-0 shadow-sm h-100">
                      <div class="card-body text-center p-4">
                        <i class="fa fa-lock fa-2x text-success mb-3"></i>
                        <h5>Pago Seguro</h5>
                        <p class="mb-0 text-muted">Todas las transacciones están protegidas con cifrado SSL</p>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4 mb-3">
                    <div class="card border-0 shadow-sm h-100">
                      <div class="card-body text-center p-4">
                        <i class="fa fa-truck fa-2x text-primary mb-3"></i>
                        <h5>Envío Confiable</h5>
                        <p class="mb-0 text-muted">Seguimiento de pedidos en tiempo real</p>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4 mb-3">
                    <div class="card border-0 shadow-sm h-100">
                      <div class="card-body text-center p-4">
                        <i class="fa fa-headphones fa-2x text-warning mb-3"></i>
                        <h5>Soporte 24/7</h5>
                        <p class="mb-0 text-muted">Estamos aquí para ayudarte en cualquier momento</p>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Botones de navegación -->
                <div class="d-flex justify-content-between mt-4">
                  <button class="btn btn-outline-secondary" type="button" awPreviousStep>
                    <i class="fa fa-arrow-left me-2"></i> Volver al Carrito
                  </button>
                </div>
              </div>
            </aw-wizard-step>

            <!-- PASO 4: CONFIRMACIÓN -->
            <aw-wizard-completion-step awEnableBackLinks>
              <ng-template awWizardStepSymbol>
                <div class="wizard-step-container">
                  <div class="wizard-step-icon bg-success text-white">
                    <i class="fa fa-check"></i>
                  </div>
                  <p class="wizard-step-text">Confirmación</p>
                </div>
              </ng-template>

              <div class="container-fluid p-4">
                <div class="text-center py-5">
                  <div class="check-circle mb-4">
                    <i class="fa fa-check-circle fa-5x text-success"></i>
                  </div>
                  <h2 class="mb-3">¡Pedido Completado!</h2>
                  <p class="mb-4 lead">Tu pedido ha sido procesado correctamente.</p>
                  <div class="row justify-content-center">
                    <div class="col-md-6">
                      <div class="card border-0 shadow-sm mb-4">
                        <div class="card-body text-center">
                          <h5 class="mb-3">Número de Pedido</h5>
                          <p class="h3 text-primary mb-0">{{pedidoGral.nroPedido}}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                  <button class="btn btn-lg btn-primary" routerLink="/ventas/lista">
                    <i class="fa fa-list me-2"></i> Ver Mis Pedidos
                  </button>
                </div>
              </div>
            </aw-wizard-completion-step>
          </aw-wizard>

          <!-- Confirmación -->
          <app-confirm *ngIf="showPedidoConfirm" [pedido]="pedidoGral"></app-confirm>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  /* Estilos para mejorar la apariencia del wizard */
  .wizard-modern {
    --primary-color: #3f51b5;
    --success-color: #4caf50;
    --warning-color: #ff9800;
    --danger-color: #f44336;
  }

  .wizard-step-container {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .wizard-step-icon {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    margin-bottom: 8px;
    box-shadow: 0 3px 5px rgba(0, 0, 0, 0.1);
  }

  .wizard-step-text {
    font-weight: 500;
    margin: 0;
  }

  .avatar-circle {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    font-weight: bold;
  }

  .check-circle {
    animation: scaleIn 0.5s ease-in-out;
  }

  @keyframes scaleIn {
    0% {
      transform: scale(0.5);
      opacity: 0;
    }

    100% {
      transform: scale(1);
      opacity: 1;
    }
  }

  /* Estilos para los tabs */
  :host ::ng-deep .custom-tabs .p-tabview-nav {
    border: none;
    background: transparent;
  }

  :host ::ng-deep .custom-tabs .p-tabview-nav li .p-tabview-nav-link {
    border-radius: 4px 4px 0 0;
    border: 1px solid #dee2e6;
    background: #f8f9fa;
    padding: 0.75rem 1.25rem;
    font-weight: 500;
  }

  :host ::ng-deep .custom-tabs .p-tabview-nav li.p-highlight .p-tabview-nav-link {
    border-color: var(--primary-color);
    background: var(--primary-color);
    color: #fff;
  }
</style>
<!-- <app-voice-interaction (transcriptionEvent)="onVoiceTranscription($event)"></app-voice-interaction> -->